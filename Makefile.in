all: lib

test-run: test lib
	LD_PRELOAD=$DESTDIR/lib/libPreloadLogger.so ./preload-logger-test

lib:
	gcc -Wall -fPIC -DPIC -shared -o lib.so lib.c logger.c gslist.c -ldl -O0 -g

test:
	gcc test.c -g -O0 -o preload-logger-test

clean:
	unset LD_PRELOAD
	rm *~ preload-logger-test lib.so -f

install: lib
	mkdir $DESTDIR/lib/ -p
	cp lib.so $DESTDIR/lib/libPreloadLogger.so
	echo "LD_PRELOAD      DEFAULT=\"$DESTDIR/lib/libPreloadLogger.so\"" >> /etc/security/pam_env.conf


uninstall:
	sed -i '\@PreloadLogger.so@d' /etc/security/pam_env.conf
	unset LD_PRELOAD
	rm $DESTDIR/lib/libPreloadLogger.so
	



